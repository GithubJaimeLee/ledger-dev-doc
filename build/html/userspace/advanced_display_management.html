

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Advanced Display Management &mdash; Ledger Documentation Hub 2 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Interaction Between BOLOS and Apps" href="syscalls.html" />
    <link rel="prev" title="Display Management" href="display_management.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Ledger Documentation Hub
          

          
          </a>

          
            
            
              <div class="version">
                2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Background Information</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../background/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/personal_security_devices.html">Personal Security Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/master_seed.html">The Master Seed</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/hd_keys.html">HD Key Generation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/hd_use_cases.html">Applications of HD Trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/application_isolation.html">Application Isolation</a></li>
</ul>
<p class="caption"><span class="caption-text">BOLOS Platform</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bolos/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bolos/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bolos/features.html">BOLOS Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bolos/hardware_architecture.html">Hardware Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bolos/application_environment.html">Application Environment</a></li>
</ul>
<p class="caption"><span class="caption-text">Userspace Development</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_apps.html">Writing Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="display_management.html">Display Management</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced Display Management</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#asynchronous-display-and-interaction-helpers">Asynchronous Display and Interaction Helpers</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bolos-ux">BOLOS UX</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="syscalls.html">Interaction Between BOLOS and Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="application_structure.html">Application Structure and I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="memory.html">Persistent Storage and PIC</a></li>
<li class="toctree-l1"><a class="reference internal" href="alignment.html">Memory alignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Common Pitfalls and Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="debugging.html">Application Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="speculos.html">Emulating devices with Speculos</a></li>
</ul>
<p class="caption"><span class="caption-text">Additional Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../additional/publishing_an_app.html">Publishing an Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/external_docs.html">External Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/security_guidelines.html">Developing Secure Ledger Apps</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ledger Documentation Hub</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Advanced Display Management</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/userspace/advanced_display_management.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="advanced-display-management">
<h1>Advanced Display Management<a class="headerlink" href="#advanced-display-management" title="Permalink to this headline">¶</a></h1>
<p>The BOLOS SDKs contain a toolkit for building GUIs called the BOLOS Application
Graphics Library (BAGL). BAGL defines a few useful types, most notably
<code class="docutils literal notranslate"><span class="pre">bagl_element_t</span></code>. This type defines a single display element, such as a
rectangle, a line of text, a touchable button (in the case of the Ledger Blue),
et cetera. Therefore, an entire GUI consists of an entire array of such
elements. As the device hardware, including the screen, is managed by the MCU,
the BAGL elements need to be transported to the MCU over SEPROXYHAL in order to
display them. This is done using a Display Status.</p>
<p>A Display Status may be used to send a single BAGL element to the MCU. However,
due to the design of the E/Cs/S protocol, in order to send a sequence of BAGL
elements the application must asynchronously send Display Statuses and wait for
Display Processed Events before sending the next one, as well as handling the
other Events that are received from the MCU in the mean time. As this is
something that must be done by every BOLOS application, a set of utilities have
been defined in the SDK to facilitate this process. These utilities also
simplify the process of handling user input events, such as button presses.</p>
<div class="section" id="asynchronous-display-and-interaction-helpers">
<h2>Asynchronous Display and Interaction Helpers<a class="headerlink" href="#asynchronous-display-and-interaction-helpers" title="Permalink to this headline">¶</a></h2>
<p>To facilitate the process of implementing an asynchronous display manager loop,
a set of macros have been defined in the BOLOS SDKs. All these macros have the
prefix <code class="docutils literal notranslate"><span class="pre">UX_</span></code>, and use a global variable of type <code class="docutils literal notranslate"><span class="pre">ux_state_t</span></code> called <code class="docutils literal notranslate"><span class="pre">ux</span></code>
to maintain the user interface state.</p>
<dl class="simple">
<dt><code class="docutils literal notranslate"><span class="pre">UX_INIT(...)</span></code></dt><dd><p>This macro is to be called when initializing the application, prior to
sending the first Display Status.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">UX_DISPLAY(...)</span></code></dt><dd><p>This macro takes an array of BAGL elements to be displayed and renders them,
asynchronously. It is to be called when a new screen is to be displayed over
the current one. This macro only sends the first element of the given array
using a Display Status. Therefore, further Commands and Statuses are
prohibited until the Display Processed Event is sent by the MCU.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">UX_REDISPLAY()</span></code></dt><dd><p>This macro restarts the process of drawing the current screen. It behaves
like <code class="docutils literal notranslate"><span class="pre">UX_DISPLAY(...)</span></code>, but takes no arguments.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">UX_DISPLAYED()</span></code></dt><dd><p>This macro returns 0 when the array requested to be displayed by
<code class="docutils literal notranslate"><span class="pre">UX_DISPLAY(...)</span></code> or <code class="docutils literal notranslate"><span class="pre">UX_REDISPLAY()</span></code> has not been displayed entirely, or
a non-zero value when it has.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">UX_DISPLAYED_EVENT(...)</span></code></dt><dd><p>This macro is to be called to handle Display Processed Events (generally in
the <code class="docutils literal notranslate"><span class="pre">io_event(...)</span></code> function). It displays the next element in the array
given as a parameter to <code class="docutils literal notranslate"><span class="pre">UX_DISPLAY(...)</span></code>. This macro sends a Display
Status if an element remains to be displayed in the given array. Therefore,
further Commands and Statuses are prohibited until the Display Processed
Event is sent by the MCU.</p>
</dd>
<dt><code class="docutils literal notranslate"><span class="pre">UX_BUTTON_PUSH_EVENT(...)</span></code></dt><dd><p>This macro facilitates handling of Button Push Events, by setting the button
released flag and calling the button handler implicitly passed to
<code class="docutils literal notranslate"><span class="pre">UX_DISPLAY(...)</span></code>.</p>
</dd>
</dl>
<p>See <a class="reference external" href="https://github.com/LedgerHQ/blue-sample-apps">the sample apps</a> for
examples of how to use these macros. The main concept to remember is that after
a Display Status has been sent, the application must wait, asynchronously, for
the Display Processed Event before being able to continue to display more
elements of the GUI.</p>
</div>
<div class="section" id="bolos-ux">
<span id="id1"></span><h2>BOLOS UX<a class="headerlink" href="#bolos-ux" title="Permalink to this headline">¶</a></h2>
<p>The BOLOS UX is the implementation of the device-wide user interface; it is a
component of the <a class="reference internal" href="../bolos/overview.html#dashboard"><span class="std std-ref">dashboard</span></a>. Applications delegate certain
jobs to the BOLOS UX in order to retain consistency across all apps for certain
UI components (like the status bar on the Ledger Blue), as well as to allow the
operating system to override the application’s UI when necessary (for example,
when locking the screen). The application interfaces with the BOLOS UX using
<code class="docutils literal notranslate"><span class="pre">os_ux(...)</span></code>, which is a syscall. However, applications don’t need to call
this function directly as it is automatically called by the display interaction
helpers (the <code class="docutils literal notranslate"><span class="pre">UX_</span></code> macros).</p>
<p>Applications should delegate Events like Button Push Events to the BOLOS UX (in
this case, using <code class="docutils literal notranslate"><span class="pre">UX_BUTTON_PUSH_EVENT(...)</span></code>) instead of handling them
directly in case the BOLOS UX needs to override the application’s UI. If the
event is consumed by the BOLOS UX (for example, a button press while the user is
unlocking the screen) then the event is not passed on to the application.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="syscalls.html" class="btn btn-neutral float-right" title="Interaction Between BOLOS and Apps" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="display_management.html" class="btn btn-neutral float-left" title="Display Management" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016 - 2019, Ledger Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>