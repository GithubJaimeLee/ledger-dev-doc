

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>HD Key Generation &mdash; Ledger Documentation Hub 2 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Applications of HD Trees" href="hd_use_cases.html" />
    <link rel="prev" title="The Master Seed" href="master_seed.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Ledger Documentation Hub
          

          
          </a>

          
            
            
              <div class="version">
                2
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Background Information</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="personal_security_devices.html">Personal Security Devices</a></li>
<li class="toctree-l1"><a class="reference internal" href="master_seed.html">The Master Seed</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">HD Key Generation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-master-node">The Master Node</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#passphrases">Passphrases</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#an-infinite-tree">An Infinite Tree</a></li>
<li class="toctree-l2"><a class="reference internal" href="#child-key-derivation-function">Child Key Derivation Function</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="hd_use_cases.html">Applications of HD Trees</a></li>
<li class="toctree-l1"><a class="reference internal" href="application_isolation.html">Application Isolation</a></li>
</ul>
<p class="caption"><span class="caption-text">BOLOS Platform</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../bolos/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bolos/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bolos/features.html">BOLOS Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bolos/hardware_architecture.html">Hardware Architecture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../bolos/application_environment.html">Application Environment</a></li>
</ul>
<p class="caption"><span class="caption-text">Userspace Development</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../userspace/introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace/setup.html">Setup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace/writing_apps.html">Writing Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace/display_management.html">Display Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace/advanced_display_management.html">Advanced Display Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace/syscalls.html">Interaction Between BOLOS and Apps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace/application_structure.html">Application Structure and I/O</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace/memory.html">Persistent Storage and PIC</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace/alignment.html">Memory alignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace/troubleshooting.html">Common Pitfalls and Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace/debugging.html">Application Debug</a></li>
<li class="toctree-l1"><a class="reference internal" href="../userspace/speculos.html">Emulating devices with Speculos</a></li>
</ul>
<p class="caption"><span class="caption-text">Additional Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../additional/publishing_an_app.html">Publishing an Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/external_docs.html">External Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../additional/security_guidelines.html">Developing Secure Ledger Apps</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Ledger Documentation Hub</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>HD Key Generation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/background/hd_keys.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="hd-key-generation">
<h1>HD Key Generation<a class="headerlink" href="#hd-key-generation" title="Permalink to this headline">¶</a></h1>
<p>In <a class="reference internal" href="master_seed.html"><span class="doc">the previous section</span></a> we discussed how Ledger devices use
a master 24-word mnemonic seed to derive a theoretically infinite number of
cryptographic secrets. Though it might seem impossible at first glance, this can
be done using nothing more than some mathematical sorcery. The process used to
do this is called hierarchical deterministic (HD) key generation.</p>
<p>The process for HD key generation used by all Ledger devices (and many other HD
wallets) is defined by <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki">BIP 32</a>.</p>
<p>Here’s how it works.</p>
<div class="section" id="the-master-node">
<h2>The Master Node<a class="headerlink" href="#the-master-node" title="Permalink to this headline">¶</a></h2>
<p>Hierarchical deterministic key generation involves creating a theoretically
infinite tree of cryptographic secrets. The root of this tree from which
everything is generated is called the master node. The master node is derived
directly from the master binary seed described in the previous section using
HMAC-SHA512. The master node of your wallet is all the information you need to
access an infinite hierarchy of private keys. As such, you should take good care
to keep your mnemonic seed safe.</p>
<div class="section" id="passphrases">
<h3>Passphrases<a class="headerlink" href="#passphrases" title="Permalink to this headline">¶</a></h3>
<p>Passphrases are a standard feature of BIP 39 supported by many HD wallets.
Passphrases are an optional way of adding additional data to the master seed
before deriving the master node of the HD wallet. By specifying a different
passphrase (or no passphrase at all), the value of the master node is completely
changed. As you will discover as you read the rest of this section, changing the
master node of the HD wallet completely changes all of the information derived
from it (for example, your Bitcoin addresses). In this way, you can keep the
same master seed on a device, but use different passphrases to access completely
unique, separated wallets.</p>
</div>
</div>
<div class="section" id="an-infinite-tree">
<h2>An Infinite Tree<a class="headerlink" href="#an-infinite-tree" title="Permalink to this headline">¶</a></h2>
<p>Descending from the master node is a tree of an infinite number of private keys.
All you need to determine a particular key is the master node (your mnemonic
seed) and the location of the key in the tree (called its “path”). This tree is
created using an incredibly powerful algorithm defined by BIP 32 called the CKD
function. All you need to know about this magical algorithm is that it can be
used to calculate any node on the HD tree given the node’s position and the
value of the master node. Essentially, the CKD function is applied to the master
node a number of times in order to “scramble” its bits and output a brand new
node. This algorithm is magical because <strong>it is impossible to reverse</strong>. Given a
private key on your tree, it is impossible to go backwards up the tree and
determine your master node.<a class="footnote-reference brackets" href="#id2" id="id1">1</a></p>
</div>
<div class="section" id="child-key-derivation-function">
<h2>Child Key Derivation Function<a class="headerlink" href="#child-key-derivation-function" title="Permalink to this headline">¶</a></h2>
<p>The HD tree is made up of “nodes”. Using the CKD function, many “child” nodes
can be derived from a single “parent” node. Each node contains three pieces of
information: a private key, a public key, and a chain code. In the case of a
cryptocurrency wallet, the private key is the part that is used to sign
transactions and the public key is used to generate the corresponding
cryptocurrency address. The node’s chain code is an extra little bit to prevent
someone from determining the children of a node using only the node’s public and
private keys.</p>
<p>The CKD function has been designed in a way that provides great flexibility in
the way child nodes are derived. Specifically, instead of requiring the public
key, private key, and chain code to derive a child node, the CKD function can be
used to derive child public keys from the parent public key and child private
keys from the parent private key. Additionally, BIP 32 defines the concept of
“hardened” child nodes. If a child node is “hardened”, then its public key
cannot be determined from its parent node’s public key.</p>
<p>These are the transformations that the CKD function can perform:</p>
<ul class="simple">
<li><p>parent private key &amp; chain code ➞ child private key &amp; chain code</p></li>
<li><p>parent public key &amp; chain code ➞ child public key &amp; chain code (unless the
child node is hardened)</p></li>
<li><p>parent private key &amp; chain code ➞ child public key &amp; chain code</p></li>
</ul>
<p>Note that it is impossible to derive a child private key from a parent public
key. This model has some interesting consequences, mainly that the parent public
key and chain code can be shared which allows someone to derive all child public
keys (unless the child nodes are hardened), but no private keys.</p>
<p>For example, this model can be used to facilitate the process of auditing an HD
wallet. By sharing the public key and chain code of all accounts in an HD
wallet, one can give an auditor the ability to view all addresses in the wallet
(without having the associated private keys). As such, the auditor could
determine what money is going where, without having access to any private keys,
meaning the auditor couldn’t sign any transactions. We’ll talk about what
“accounts” are in the next section.</p>
<p>For a more detailed list and explanation of some of the use-cases made possible
by this model, see <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki#use-cases">this section</a> of
the BIP 32 specification.</p>
<p>In the next section, <a class="reference internal" href="hd_use_cases.html"><span class="doc">Applications of HD Trees</span></a>, we’ll talk about how all of these
features are used by HD wallets and other applications.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>If you’d like to play with BIP 39 mnemonics or BIP 32 derivation on a
computer, take a look at this tool: <a class="reference external" href="https://iancoleman.io/bip39/">https://iancoleman.io/bip39/</a>.</p>
</div>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="id2"><span class="brackets"><a class="fn-backref" href="#id1">1</a></span></dt>
<dd><p>Technically it isn’t impossible to determine a node given the child node and
the corresponding index, but there is no known attack to do this faster than
a properly executed brute-force attack. See <a class="reference external" href="https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki#security">this section of BIP 32</a>
for details.</p>
</dd>
</dl>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="hd_use_cases.html" class="btn btn-neutral float-right" title="Applications of HD Trees" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="master_seed.html" class="btn btn-neutral float-left" title="The Master Seed" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2016 - 2019, Ledger Team.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>